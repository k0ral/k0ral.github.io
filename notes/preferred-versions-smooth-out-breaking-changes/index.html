<!doctype html><html lang=en data-theme=dark><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=../../css/modern-normalize.css><link rel=stylesheet href=../../css/water.css><link rel=stylesheet href=../../sass/main.css><title>Preferred-versions smooth out breaking changes | My digital garden</title></head><body><header><nav><ul><li><strong><a href=../../>My digital garden</a></strong></li></ul><ul><li><a href=../../notes>Notes</a></li><li><a href=../../archives>Archives</a></li><li><a href=../../tags>Tags</a></li><li><a href=../../diataxis>Diataxis</a></li></ul></nav></header><main data-pagefind-body><hgroup><h1>Preferred-versions smooth out breaking changes</h1><ul class=tags><li><a href=../../tags/software-craftsmanship>software-craftsmanship</a></li></ul></hgroup><p>Preferred-versions are a <a href=https://hackage.haskell.org/>Hackage</a> feature that looks <a href=https://hackage.haskell.org/packages/preferred>mostly unused</a>, whereas it enables a software release strategy that can mitigate the damage caused by API-breaking changes. This article is an attempt to advertise this strategy.</p><p>Note: the idea is applicable to any software ecosystem, provided the concept of preferred-versions is implemented by the installer.</p><p>API-breaking changes cause conflicts between:</p><ul><li>users who need the changes as soon as possible;</li><li>users who don’t care about the changes and perceive them as a migration cost only.</li></ul><p>According to the hackage documentation:</p><blockquote><p>If a range of versions is preferred, it means that the installer won’t install a non-preferred package version unless it is explicitly specified or if it’s the only choice the installer has</p></blockquote><p>We can leverage this feature to create a transition period during which a new version is available only if explicitly requested in the <code>.cabal</code> file. As a consequence, early-adopters can enjoy the new API while other users aren’t impacted in their daily workflow. In other words: the new API is opt-in.</p><p>To be accurate, here is an example procedure:</p><ul><li>let <code>A.B.C.D</code> be the latest published version (assuming you are following the <a href=https://pvp.haskell.org/>Haskell PVP</a>)</li><li>release a new version <code>A.B.C.(D+1)</code> that only includes additional deprecation markers to warn users about the upcoming breaking change;</li><li>release a new version <code>A.(B+1).0.0</code> that includes the breaking changes</li><li>on Hackage, set the “Preferred versions” such that <code>A.B.C.(D+1)</code> is preferred over <code>A.(B+1).0.0</code></li><li>after a reasonable time, remove the preferred version so that <code>A.(B+1).0.0</code> becomes the new default</li></ul><p>As is often the case, one size does not fit all: this strategy may not be appropriate to your project, but it is worth considering.</p></main></body></html>